<template>
  <div class="page" data-name="home">
    <!-- Top Navbar -->
    <div class="navbar">
      <div class="navbar-bg"></div>
      <div class="navbar-inner">
        <div class="left">
          <a href="#" class="link icon-only panel-open" data-panel="left">
            <i class="icon f7-icons if-not-md">menu</i>
            <i class="icon material-icons if-md">menu</i>
          </a>
        </div>
        <div class="title sliding">Flaxa Green</div>
        <div class="right">
          <a href="#" class="link icon-only panel-open" data-panel="right">
            <i class="icon f7-icons if-not-md">menu</i>
            <i class="icon material-icons if-md">menu</i>
          </a>
        </div>
      </div>
    </div>
    <!-- Scrollable page content-->
    <div class="page-content">
      <div class="list list-strong list-outline list-dividers-ios no-chevron">
        <ul>
          <li class="list-group-title">Quick Actions</li>
          <li>
            <a href="/general-info/" class="item-content item-link">
              <div class="item-media"><i class="icon f7-icons">info_circle</i></div>
              <div class="item-inner">
                <div class="item-title">General Information</div>
              </div>
            </a>
          </li>
          <li>
            <a href="#" class="item-content item-link" @click=${chooseAcc}>
              <div class="item-media"><i class="icon f7-icons">doc_text_viewfinder</i></div>
              <div class="item-inner">
                <div class="item-title">Active Account
                </div>
                <div class="item-after">${active}</div>
              </div>
            </a>
          </li>
          <li>
            <a href="#" class="item-content item-link" @click=${popAccDialog}>
              <div class="item-media"><i class="icon f7-icons">wallet</i></div>
              <div class="item-inner">
                <div class="item-title">Add Account</div>
              </div>
            </a>
          </li>
          <li>
            <a href="#" class="item-content item-link" @click=${showCalendar}>
              <div class="item-media"><i class="icon f7-icons">calendar_badge_plus</i></div>
              <div class="item-inner">
                <div class="item-title">Add Date Entry</div>
              </div>
            </a>
          </li>
        </ul>
      </div>
      <div class="list list-outline-ios list-strong-ios list-dividers-ios">
        <ul>
          <li class="list-group-title">Timeline</li>
          ${tldata.map(entry => $h`
            <li>
              <a href="/transact/Date/FirstBank/" class="item-link item-content no-chevron">
                <div class="item-inner">
                  <div class="item-title">
                    <div class="item-header">${entry.acc} - Sat 25/Nov/2023</div>
                    <div class="inout">
                      NET CASH FLOW: ${entry.out}
                    </div>
                  </div>
                  <div class="item-after"><i class="f7-icons if-not-md">trash_fill</i></div>
                </div>
              </a>
            </li>
          `)}
        </ul>
      </div>
    </div>
  </div>
</template>

<style>
  .item-media {
    color: var(--f7-list-item-after-text-color)
  }
  .size-20 { font-size: 20px }
  .size-25 { font-size: 25px }
  .size-30 { font-size: 30px }
  .size-50 { font-size: 50px }

  .inout {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 1px;
    padding-bottom: 1px;
    width: auto;
    max-width: 100%;
  }

  .flow {
    padding-left: 4px;
    padding-right: 8px;
  }
</style>

<script>
  export default (props, { $f7ready, $f7, $, $on, $onMounted, $onBeforeUnmount, $onUnmounted, $update }) => {
    const TOPG = {}; 
    const page = $('.page[data-name="home"]')[0];
    // todo del mock data
    const accounts = [
      { text: "FirstBank", 
      onClick: function(actions, e) {
        active = e.target.textContent; $update();
      }},
      { text: "GTBank",
      onClick: function(actions, e) {
        active = e.target.textContent; $update();
      }},
      { text: "FidelityBank",
      onClick: function(actions, e) {
        active = e.target.textContent; $update();
      }},
    ]
    const tldata = [
      {date: Date.UTC(2023, 10, 25), acc: "FirstBank", out: 1000, in: 300 },
      {date: Date.UTC(2023, 10, 23), acc: "FirstBank", out: 1000, in: 300 },
      {date: Date.UTC(2023, 10, 22), acc: "FirstBank", out: 1000, in: 300 },
      {date: Date.UTC(2023, 10, 22), acc: "FirstBank", out: 1000, in: 300 },
      {date: Date.UTC(2023, 10, 22), acc: "FirstBank", out: 1000, in: 300 },
      {date: Date.UTC(2023, 10, 22), acc: "FirstBank", out: 1000, in: 300 },
      {date: Date.UTC(2023, 10, 22), acc: "FirstBank", out: 1000, in: 300 },
    ];


    let active = accounts[0].text;
    $on('pageInit', () => {
      const buttons2 = [
        // First Group
        accounts,
        // Second Group
        [
          {
            text: 'Cancel',
            color: 'red'
          }
        ]
      ]
      TOPG.actionSheet = $f7.actions.create({ 
        buttons: buttons2 ,
        // containerEl: ".page-master",
      });
      TOPG.calendarModal = $f7.calendar.create({
        disabled: {
          from: new Date()
        },
        dateFormat: { weekday: 'long', month: 'long', day: '2-digit', year: 'numeric' },
        openIn: 'customModal',
        header: true,
        footer: true,
        on: {
          closed: function () {
            $f7.dialog.alert('hello world');
          }
        }
      });
    })

    $onBeforeUnmount(() => {
      $f7.calendar.destroy('#demo-calendar-modal');
    })
    $on('pageBeforeRemove', () => {
      TOPG.actionSheet.destroy();
    })
    $onUnmounted(() => {
      Object.keys(TOPG).forEach(key => delete TOPG[key]);
    })

    /* 
    todo timeline db schema
    [id:pri-key(use utcdatenum), y, m, d, acc, out, in, at, search(combine: acc+out+in+at)]

    todo
    on calendar close check some vars, if they are null, report "select a date".
    on calender change, set those vars, then attempt to insert into sql, if fail report "date already exist" else "Done: added date".
    */

    function showCalendar () {
      TOPG.calendarModal.open();
    }

    function chooseAcc () {
      console.log('choosing...')
      TOPG.actionSheet.open();
    }

    const maxamt = 100000000000000; // todo use the real deal.
    let dialoginputs = `
<form id="create">
  <div class="dialog-input-field dialog-input-double input">
    <input type="text" name="dialog-accname" placeholder="Account name" class="dialog-input" pattern='[\-A-Za-z0-9]+' data-pattern="Account name accepts only alpha-numeric characters and hyhens!" maxlength=20 required />
  </div>
  <div class="dialog-input-field dialog-input-double input">
    <input type="number" name="dialog-accbal" placeholder="Cash balance" class="dialog-input" data-range="The cash balance provided exceeds limits!" max=${maxamt} min=0 data-step="Invalid lower denominations" step=0.01 required />
  </div>
</form>`;

    function popAccDialog(){
      let dialog = $f7.dialog.create({
        // containerEl: ".page-master",
        // backdrop: false,
        title: 'Add Account',
        text: '',
        content: dialoginputs,
        buttons: [
          { text: 'Cancel', close: true, },
          {
            text: 'Save', keyCodes: [13], 
            close: true,
            onClick: function(dialog, e){
              
            }
          },
        ],
        destroyOnClose: true,
      })
      dialog.open();
    }  


    return $render;
  }
</script>